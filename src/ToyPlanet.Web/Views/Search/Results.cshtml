@model ToyPlanet.Web.Controllers.SearchViewModel

@{
    ViewData["Title"] = "–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É";
}

<div class="container mt-5">
    <h2 style="color: #e75480; margin-bottom: 20px;">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É –∑–∞–º–æ–≤–ª–µ–Ω—å</h2>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –¥–æ —Ñ–æ—Ä–º–∏ –ø–æ—à—É–∫—É -->
    <div class="mb-4">
        <a href="/Search/Index" class="btn btn-outline-primary">‚Üê –ù–æ–≤–∞ –ø–æ—à—É–∫</a>
        <span class="badge bg-info ms-2">–ó–Ω–∞–π–¥–µ–Ω–æ: @(Model?.Results?.Count ?? 0)</span>
    </div>

    @if (Model?.Results != null && Model.Results.Any())
    {
        <div class="table-responsive">
            <table class="table table-hover table-striped table-bordered">
                <thead style="background: linear-gradient(135deg, #e75480 0%, #6a5acd 100%); color: white; position: sticky; top: 0;">
                    <tr>
                        <th style="width: 15%;">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
                        <th style="width: 15%;">–î–∞—Ç–∞</th>
                        <th style="width: 20%;">Email</th>
                        <th style="width: 30%;">–¢–æ–≤–∞—Ä–∏</th>
                        <th style="width: 10%;">–ö—ñ–ª-—Å—Ç—å</th>
                        <th style="width: 10%;">–°—É–º–∞</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var order in Model.Results)
                    {
                        <tr class="align-middle">
                            <td>
                                <a href="/Orders/Details/@order.Id" class="text-decoration-none fw-bold" style="color: #e75480;">
                                    #@order.Id.ToString("N").Substring(0, 8)...
                                </a>
                            </td>
                            <td>
                                <small>@order.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy")</small>
                                <br />
                                <small class="text-muted">@order.CreatedAt.ToLocalTime().ToString("HH:mm")</small>
                            </td>
                            <td>
                                <strong>@order.UserEmail</strong>
                            </td>
                            <td>
                                @if (order.Items != null && order.Items.Any())
                                {
                                    <ul class="list-unstyled mb-0">
                                        @foreach (var item in order.Items.Take(3))
                                        {
                                            <li style="border-bottom: 1px solid #eee; padding: 5px 0;">
                                                <strong>@item.Toy?.Name</strong>
                                                <br />
                                                <small class="text-muted">–ö—ñ–ª-—Å—Ç—å: @item.Quantity | –¶—ñ–Ω–∞: @item.Price ‚Ç¥</small>
                                            </li>
                                        }
                                        @if (order.Items.Count > 3)
                                        {
                                            <li style="padding: 5px 0;">
                                                <em class="text-muted">... —Ç–∞ —â–µ @(order.Items.Count - 3) —Ç–æ–≤–∞—Ä(—ñ–≤)</em>
                                            </li>
                                        }
                                    </ul>
                                }
                            </td>
                            <td>
                                <span class="badge bg-secondary">@(order.Items?.Count ?? 0)</span>
                            </td>
                            <td>
                                <strong style="color: #e75480; font-size: 1.1rem;">@order.Total ‚Ç¥</strong>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="mt-4 p-3" style="background: #f8f9fa; border-radius: 5px;">
            <strong>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong>
            <ul class="list-unstyled mt-2">
                <li>‚úÖ –í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: <strong style="color: #e75480;">@Model.Results.Count</strong></li>
                <li>üí∞ –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: <strong style="color: #4caf50;">@Model.Results.Sum(o => o.Total) ‚Ç¥</strong></li>
                <li>üì¶ –í—Å—å–æ–≥–æ —Ç–æ–≤–∞—Ä—ñ–≤: <strong>@Model.Results.Sum(o => o.Items?.Count ?? 0)</strong></li>
                <li>üí≥ –°–µ—Ä–µ–¥–Ω—è –≤–∞—Ä—Ç—ñ—Å—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: <strong>@(Model.Results.Any() ? (Model.Results.Sum(o => o.Total) / Model.Results.Count).ToString("F2") : "0") ‚Ç¥</strong></li>
            </ul>
        </div>
    }
    else
    {
        <div class="alert alert-warning" style="background: #fff3cd; border: 1px solid #ffc107; border-left: 4px solid #ffc107;">
            <h5 class="alert-heading">‚ö†Ô∏è –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ</h5>
            <p>–ó–∞ –≤–∏–±—Ä–∞–Ω–∏–º–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º–∏ –ø–æ—à—É–∫—É –∑–∞–º–æ–≤–ª–µ–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>
            <hr>
            <a href="/Search/Index" class="btn btn-sm btn-warning">–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ñ–Ω—à—É –ø–æ—à—É–∫</a>
        </div>
    }

    <div class="mt-5">
        <a href="/Search/Index" class="btn btn-outline-primary">‚Üê –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ñ–Ω—à—É –ø–æ—à—É–∫</a>
        <a href="/" class="btn btn-outline-secondary">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
    </div>
</div>

<style>
    .table-hover tbody tr:hover {
        background-color: rgba(231, 84, 128, 0.08) !important;
    }
    
    tbody tr {
        transition: all 0.3s ease;
    }
    
    .badge {
        padding: 0.35em 0.65em;
        font-size: 0.85em;
    }
</style>
