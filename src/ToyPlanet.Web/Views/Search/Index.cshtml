@model ToyPlanet.Web.Controllers.SearchViewModel

@{
    ViewData["Title"] = "–ü–æ—à—É–∫ –ü–æ–Ω—ñ ü¶Ñ";
}

<div class="container mt-5">
    <h2 style="color: #e75480; margin-bottom: 30px;">üîç –†–æ–∑—à–∏—Ä–µ–Ω–∏–π –ø–æ—à—É–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å –ü–æ–Ω—ñ</h2>
    
    <div class="card shadow-lg border-0 mb-4" style="border-left: 4px solid #6a5acd;">
        <div class="card-header" style="background: #f8f9fa; border-bottom: 2px solid #e75480;">
            <h5 class="mb-0">ü¶Ñ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –ø–æ—à—É–∫—É</h5>
        </div>
        <div class="card-body">
            <form method="post" asp-action="Results" class="needs-validation">
                <div class="row">
                    <!-- –ü–æ—à—É–∫ –∑–∞ –¥–∞—Ç–æ—é -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label" style="color: #6a5acd; font-weight: 500;">üìÖ –î–∞—Ç–∞ –≤—ñ–¥</label>
                        <input type="date" class="form-control" name="DateFrom" 
                               value="@Model?.DateFrom?.ToString("yyyy-MM-dd")" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label" style="color: #6a5acd; font-weight: 500;">üìÖ –î–∞—Ç–∞ –¥–æ</label>
                        <input type="date" class="form-control" name="DateTo" 
                               value="@Model?.DateTo?.ToString("yyyy-MM-dd")" />
                    </div>
                </div>

                <div class="row">
                    <!-- –ü–æ—à—É–∫ –∑–∞ —ñ–º–µ–Ω–µ–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–ø—Ä–µ—Ñ—ñ–∫—Å/—Å—É—Ñ—ñ–∫—Å) -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label" style="color: #6a5acd; font-weight: 500;">üë§ Email –ø–æ–∫—É–ø—Ü—è</label>
                        <input type="text" class="form-control" name="UserName" placeholder="–í–≤–µ–¥—ñ—Ç—å email (–ø—Ä–µ—Ñ—ñ–∫—Å –∞–±–æ —Å—É—Ñ—ñ–∫—Å)"
                               value="@Model?.UserName" />
                        <small class="text-muted">–ü–æ—à—É–∫ –∑–∞ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º –∞–±–æ —Å—É—Ñ—ñ–∫—Å–æ–º</small>
                    </div>

                    <!-- –ü–æ—à—É–∫ –∑–∞ –∫–∞—Ç–µ–≥–æ—Ä—ñ—î—é -->
                    <div class="col-md-6 mb-3">
                        <label class="form-label" style="color: #6a5acd; font-weight: 500;">ü¶Ñ –ö–∞—Ç–µ–≥–æ—Ä—ñ—è –ü–æ–Ω—ñ</label>
                        <select class="form-control" name="CategoryId">
                            <option value="">-- –í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó --</option>
                            @if (Model?.Categories != null)
                            {
                                @foreach (var category in Model.Categories)
                                {
                                    <option value="@category.Id" 
                                            selected="@(Model.CategoryId == category.Id ? "selected" : "")">
                                        @category.Name
                                    </option>
                                }
                            }
                        </select>
                    </div>
                </div>

                <div class="row">
                    <!-- –ü–æ—à—É–∫ –∑–∞ –Ω–∞–∑–≤–æ—é –ü–æ–Ω—ñ -->
                    <div class="col-md-12 mb-3">
                        <label class="form-label" style="color: #6a5acd; font-weight: 500;">üåà –ù–∞–∑–≤–∞ –ü–æ–Ω—ñ</label>
                        <input type="text" class="form-control" name="ToyName" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø–æ–Ω—ñ (Rainbow Dash, Twilight, —Ç–æ—â–æ)"
                               value="@Model?.ToyName" />
                        <small class="text-muted">–ü–æ—à—É–∫ –∑–∞ –Ω–∞–∑–≤–æ—é (–º—ñ—Å—Ç–∏—Ç—å, –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è, –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è)</small>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12">
                        <button type="submit" class="btn btn-lg" style="background: #e75480; color: white; border-radius: 5px;">
                            üîç –ü–æ—à—É–∫–∞—Ç–∏ –ü–æ–Ω—ñ
                        </button>
                        <a href="/" class="btn btn-lg btn-outline-secondary">–û—á–∏—Å—Ç–∏—Ç–∏</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É -->
    @if (Model?.Results != null && Model.Results.Any())
    {
        <div class="alert alert-success" style="background: #e8f5e9; border-left: 4px solid #4caf50;">
            <strong>‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: @Model.Results.Count</strong>
        </div>

        <div class="table-responsive">
            <table class="table table-hover table-striped table-bordered">
                <thead style="background: linear-gradient(135deg, #e75480 0%, #6a5acd 100%); color: white;">
                    <tr>
                        <th>‚Ññ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>Email –ø–æ–∫—É–ø—Ü—è</th>
                        <th>–ü–æ–Ω—ñ</th>
                        <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–∑–∏—Ü—ñ–π</th>
                        <th>–°—É–º–∞</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var order in Model.Results)
                    {
                        <tr>
                            <td>
                                <a href="/Orders/Details/@order.Id" class="text-decoration-none">
                                    <strong>#@order.Id.ToString("N").Substring(0, 8)</strong>
                                </a>
                            </td>
                            <td>@order.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                            <td>@order.UserEmail</td>
                            <td>
                                @if (order.Items != null && order.Items.Any())
                                {
                                    <div class="small">
                                        @foreach (var item in order.Items)
                                        {
                                            <div>‚Ä¢ <strong>@item.Toy?.Name</strong> (@item.Quantity x @item.Price ‚Ç¥)</div>
                                        }
                                    </div>
                                }
                            </td>
                            <td>@(order.Items?.Count ?? 0)</td>
                            <td><strong style="color: #e75480;">@order.Total ‚Ç¥</strong></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else if (Model?.Results != null && !Model.Results.Any())
    {
        <div class="alert alert-warning" style="background: #fff3cd; border-left: 4px solid #ffc107;">
            <strong>‚ö†Ô∏è –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ</strong> –∑–∞ –≤–∏–±—Ä–∞–Ω–∏–º–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º–∏.
        </div>
    }
    else if (Model == null || !Model.Results.Any())
    {
        <div class="alert alert-info">
            <strong>üí° –ü—ñ–¥–∫–∞–∑–∫–∞:</strong> –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –∫—Ä–∏—Ç–µ—Ä—ñ—ó –ø–æ—à—É–∫—É –≤–∏—â–µ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ü–æ—à—É–∫–∞—Ç–∏ –ü–æ–Ω—ñ".
        </div>
    }

    <div class="mt-4">
        <a href="/" class="btn btn-outline-secondary">‚Üê –ù–∞ –≥–æ–ª–æ–≤–Ω—É</a>
    </div>
</div>

<style>
    .table-hover tbody tr:hover {
        background-color: rgba(231, 84, 128, 0.08) !important;
    }
    
    .form-control:focus {
        border-color: #e75480 !important;
        box-shadow: 0 0 0 0.2rem rgba(231, 84, 128, 0.25) !important;
    }
    
    .form-label {
        font-size: 0.95rem;
    }
</style>
